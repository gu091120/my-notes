# TCP/IP

## 基本概念
### `TCP/IP`含义
可以单指TCP协议和IP协议。更多是指需要用到IP协议的协议群，包括传输层，应用层等等
![](https://upload-images.jianshu.io/upload_images/1856419-ca4aba22c1f7a217.png)

### 数据包
- 包：全能行术语
- 帧：表示链路层数据基本单位
- 数据包：IP、UDP网络层的数据基本单位
- 段：TCP传输层的数据基本单位
- 消息：http等应用层等的数据基本单位

### 数据处理
![](https://upload-images.jianshu.io/upload_images/1856419-2051967a4e85d719.png)


### 计算机网络分层
![](https://upload-images.jianshu.io/upload_images/1856419-c69d60eeeebadd37.png)

## IP协议
### IP地址
通过`ip地址`连接网络中的所有主机，IP地址由`网络地址(192.168.130.)`+`主机地址(156)`

### 分包组包
由于每次传输的数据包大小是有限制的，所以在传输较大的数据的时候，就需要主机或者路由去对数据包进行分包，最后由目标主机进行组包。

### IP数据包主要组成
目标ip地址+源目标ip地址+tcp协议号+其他数据(tcp，http等)


## TCP协议
### TCP和UDP的比较
- TCP：面相连接，可靠的流协议。数据传输比较慢，但是完整
- UDP：不可靠的数据报协议。数据传输比较快，但是存在丢包的可能

### TCP段的组成
目标端口号+源端口号+其他数据

### TCP建立连接（3次握手）
- 第一次握手：客户端将标志位SYN置为1，随机产生一个值seq=J，并将该数据包发送给服务器端，客户端进入SYN_SENT状态，等待服务器端确认。
- 第二次握手：服务器端收到数据包后由标志位SYN=1知道客户端请求建立连接，服务器端将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给客户端以确认连接请求，服务器端进入SYN_RCVD状态。
- 第三次握手：客户端收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给服务器端，服务器端检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，客户端和服务器端进入ESTABLISHED状态，完成三次握手，随后客户端与服务器端之间可以开始传输数据了。



### TCP断开连接（4次握手）

- 四次挥手即终止TCP连接，就是指断开一个TCP连接时，需要客户端和服务端总共发送4个包以确认连接的断开。在socket编程中，这一过程由客户端或服务端任一方执行close来触发。
- 由于TCP连接是全双工的，因此，每个方向都必须要单独进行关闭，这一原则是当一方完成数据发送任务后，发送一个FIN来终止这一方向的连接，收到一个FIN只是意味着这一方向上没有数据流动了，即不会再收到数据了，但是在这个TCP连接上仍然能够发送数据，直到这一方向也发送了FIN。首先进行关闭的一方将执行主动关闭，而另一方则执行被动关闭。



## 参考
- [一篇文章带你熟悉 TCP/IP 协议（网络协议篇二）](https://www.jianshu.com/p/9f3e879a4c9c)
- [WebSocket与TCP/IP](https://zhuanlan.zhihu.com/p/27021102?refer=dreawer)